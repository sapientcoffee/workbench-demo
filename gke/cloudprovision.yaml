create:
  steps:
  - id: Inspect Values
    name: ubuntu
    entrypoint: bash
    args: ["-c",
      "echo APP_ID=${_APP_ID} _APP_NAME='${_APP_NAME}' _GOOGLE_CLOUD_PROJECT=${_GOOGLE_CLOUD_PROJECT} _GOOGLE_CLOUD_DEFAULT_REGION='${_REGION}' _BILLING_ACCOUNT=${_BILLING_ACCOUNT} _FOLDER_ID=${_FOLDER_ID}
      _CREATE_BASTION=${_CREATE_BASTION} "]
  - id: clone AppDev
    name: gcr.io/cloud-builders/git
    entrypoint: bash
    args: ["-c",
          "git clone -b main https://github.com/sapientcoffee/workbench-demo.git"]
  - id: Create deployment with Infra Manager
    name: gcr.io/cloud-builders/gcloud
    env:
    - APP_ID=${_APP_ID}
    - APP_NAME=${_APP_NAME}
    - GOOGLE_CLOUD_PROJECT=${_GOOGLE_CLOUD_PROJECT}
    - GOOGLE_CLOUD_DEFAULT_REGION=${_REGION}
    - FOLDER_ID=${_FOLDER_ID}
    - BILLING_ACCOUNT=${_BILLING_ACCOUNT}
    - CREATE_BASTION=${_CREATE_BASTION}
    - GOOGLE_CLOUD_DB_PROJECT=${_GOOGLE_CLOUD_PROJECT}
    - GOOGLE_CLOUD_K8S_PROJECT=${_GOOGLE_CLOUD_PROJECT}
    script: "cd workbench-demo/gke/ && ./create.sh"
destroy:
  steps:
  - id: Inspect Values
    name: ubuntu
    entrypoint: bash
    args: ["-c",
      "echo APP_ID=${_APP_ID} _APP_NAME=${_APP_NAME} _GOOGLE_CLOUD_PROJECT=${_GOOGLE_CLOUD_PROJECT} _GOOGLE_CLOUD_DEFAULT_REGION='${_REGION}' _BILLING_ACCOUNT=${_BILLING_ACCOUNT} _FOLDER_ID=${_FOLDER_ID}
      _CREATE_BASTION=${_CREATE_BASTION} "]
inputs:
- param: _APP_NAME
  label: Application Name
  description: Application that will be deployed.
  type: string
  required: true
- param: _GOOGLE_CLOUD_PROJECT
  label: Google Cloud Project
  description: Application that will be deployed.
  type: string
  required: true
- param: _REGION
  label: Application Region
  description: Where do you want to deploy the application?
  type: string
  required: true
- param: _BILLING_ACCOUNT
  label: Google Cloud Billing Account
  description: Instance GitHub Repository Owner
  type: string
  required: true
- param: _FOLDER_ID
  label: Google Cloud Folder
  description: Instance GitHub Repository Token
  type: string
  required: true
- param: _CREATE_BASTION
  label: Bastion Host - true or false
  description: GCP API Key
  type: string
  required: false
  display: true
outputs:
- param: _BUILD_URL
  label: Cloud Build Url
  description: Cloud Build Url
  type: string
  required: true